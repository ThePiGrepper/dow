#!/bin/sh
#
# Apply commit to data repository.

# Index and parents setup in pre-commit hook.

data_repo=../data
map=../map

versions_sha=`git rev-parse HEAD`

message=`git log -1 --format=format:%B HEAD`
GIT_AUTHOR_NAME=`git log -1 --format=format:%an HEAD`
GIT_AUTHOR_EMAIL=`git log -1 --format=format:%ae HEAD`
GIT_AUTHOR_DATE=`git log -1 --format=format:%ad HEAD`
GIT_COMMITTER_NAME=`git log -1 --format=format:%cn HEAD`
GIT_COMMITTER_EMAIL=`git log -1 --format=format:%ce HEAD`
# Use automatic GIT_COMMITTER_DATE.

cd $data_repo
git commit -m "$message" --no-verify

data_sha=`git rev-parse HEAD`

# Add commit pair to database.
cd $map
mkdir -p ${data_sha:0:2} ${versions_sha:0:2}
echo $versions_sha > ${data_sha:0:2}/${data_sha:2}
echo $data_sha > ${versions_sha:0:2}/${versions_sha:2}

